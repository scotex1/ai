<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Generate Hotel Description</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-100 p-6">

<div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow">
  <h2 class="text-2xl font-bold mb-6">Generate Hotel Description</h2>

  <input id="hotelName" placeholder="Hotel Name" class="w-full mb-3 p-3 border rounded">
  <input id="city" placeholder="City" class="w-full mb-3 p-3 border rounded">
  <textarea id="facilities" placeholder="Facilities (comma separated)" class="w-full mb-3 p-3 border rounded"></textarea>
  <select id="tone" class="w-full mb-4 p-3 border rounded">
    <option>Luxury</option>
    <option>Budget</option>
    <option>Family</option>
    <option>Business</option>
  </select>

  <button id="generateBtn" class="w-full bg-indigo-600 text-white p-3 rounded">Generate with AI</button>

  <h3 class="mt-6 font-bold">Output:</h3>
  <div id="output" class="mt-2 p-3 bg-gray-50 rounded border min-h-[80px]"></div>
</div>

<script>
  // Firebase Config (replace with your own)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Check user logged in
  let currentUser = null;
  auth.onAuthStateChanged((user) => {
    if(user){
      currentUser = user;
      console.log("User logged in:", user.email);
    } else {
      alert("Please login first!");
      window.location.href = "login.html";
    }
  });

  // Generate button
  document.getElementById("generateBtn").addEventListener("click", async () => {
    if(!currentUser) return alert("User not logged in!");

    const hotelName = document.getElementById("hotelName").value;
    const city = document.getElementById("city").value;
    const facilities = document.getElementById("facilities").value;
    const tone = document.getElementById("tone").value;

    if(!hotelName || !city) return alert("Hotel name & city required!");

    // Show loading
    const outputDiv = document.getElementById("output");
    outputDiv.innerText = "Generating...";

    try {
      // Call backend OpenAI API
      const response = await fetch("https://your-backend.com/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ hotelName, city, facilities, tone })
      });

      const data = await response.json();
      outputDiv.innerText = data.description;

      // Save to Firestore
      db.collection("users").doc(currentUser.uid)
        .collection("history")
        .add({
          hotelName,
          city,
          facilities,
          tone,
          description: data.description,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

    } catch (err) {
      console.error(err);
      outputDiv.innerText = "Error generating description.";
    }
  });
</script>
<div id="navbar"></div>

<script>
  async function loadNavbar() {
    const res = await fetch('navbar.html');
    const html = await res.text();
    document.getElementById('navbar').innerHTML = html;
  }

  loadNavbar();
  function logout() {
  firebase.auth().signOut().then(() => {
    window.location.href = 'login.html';
  }).catch((err) => {
    console.error(err);
  });
}

</script>

</body>
</html>
